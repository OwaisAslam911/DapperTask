@{
    ViewBag.Title = "Employee Filter";
}

<div class="content-body">
    <h1>Employee Filter</h1>

    <!-- Filter Form -->
    <form id="filterForm">
        <div class="dropdown" style="width:100%">
            <div class="d-flex flex-grow-1">
                <div>
                    <label for="organizationSelect">Organization:</label>
                    <select class="form-control" id="OrganizationId" aria-label="Default select example" asp-items="ViewBag.Organizations">
                        <option selected value="">Select Organization</option> <!-- Ensure value is empty -->
                    </select>
                </div>

                <div>
                    <label for="departmentSelect">Department:</label>
                    <select class="form-control" id="DepartmentId" aria-label="Default select example" asp-items="ViewBag.Departments">
                        <option selected value="">Select Department</option> <!-- Ensure value is empty -->
                    </select>
                </div>

                <div>
                    <label for="positionSelect">Position:</label>
                    <select class="form-control" id="PositionId" aria-label="Default select example" asp-items="ViewBag.Positions">
                        <option selected value="">Select Position</option> <!-- Ensure value is empty -->
                    </select>
                </div>
            </div>
            <button type="button" class="btn btn-primary" id="filterButton">Filter</button>
        </div>
    </form>

    <!-- Table to display employees -->
    <table id="employeeTable" class="table">
        <thead>
            <tr>
                <th>Organization</th>
                <th>Department</th>
                <th>Position</th>
                <th>Employee Name</th>
                <th>Salary</th>
            </tr>
        </thead>
        <tbody id="employeeTableBody">
            @foreach (var item in ViewBag.defaultValues)
            {
                <tr>
                    <td>@item.OrganizationName</td>
                    <td>@item.DepartmentName</td>
                    <td>@item.PositionTitle</td>
                    <td>@item.EmployeeName</td>
                    <td>@item.Salary</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>

    $(document).ready(function () {
        $('#filterButton').click(function () {
            debugger;
            // Get the selected values from the dropdowns
            var organizationId = $('#OrganizationId').val();
            var departmentId = $('#DepartmentId').val();
            var positionId = $('#PositionId').val();

            // AJAX request to filter employees
            $.ajax({
                url: '/Home/Filter', // Ensure the correct controller name
                type: 'GET',
                data: {
                    organizationId: organizationId || null, // Send null if not selected
                    departmentId: departmentId || null,     // Send null if not selected
                    positionId: positionId || null           // Send null if not selected
                },
                success: function (data) {
                    // Clear existing table body
                    $('#employeeTableBody').empty();

                    // Populate table with filtered data
                    if (data.length > 0) {
                        $.each(data, function (index, item) {
                            $('#employeeTableBody').append(
                                '<tr>' +
                                '<td>' + item.organizationId + '</td>' +
                                '<td>' + item.departmentId + '</td>' +
                                '<td>' + item.positionId + '</td>' +
                                '<td>' + item.employeeName + '</td>' +
                                '<td>' + item.salary + '</td>' +
                                '</tr>'
                            );
                        });
                    } else {
                        $('#employeeTableBody').append('<tr><td colspan="5">No employees found</td></tr>');
                    }
                },
                error: function (xhr, status, error) {
                    alert('Error occurred while fetching data: ' + error);
                }
            });
        });
    });
</script>
