@model IEnumerable<DapperTask.Models.PositionMappingViewModel>

<div class="container">
    <h2>Map Positions to Departments</h2>

    <form id="positionMappingForm" method="post">
        <div class="mb-3">
            <label for="OrganizationId" class="form-label">Organization</label>
            <select id="OrganizationId" name="OrganizationId" class="form-select">
                <option value="">Select Organization</option>
                @foreach (var organization in ViewBag.Organizations)
                {
                    <option value="@organization.OrganizationId">@organization.OrganizationName</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label for="DepartmentId" class="form-label">Department</label>
            <select id="DepartmentId" name="DepartmentId" class="form-select">
                <option value="">Select Department</option>
                @foreach (var department in ViewBag.Departments)
                {
                    <option value="@department.DepartmentId">@department.DepartmentName</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label for="PositionId" class="form-label">Position</label>
            <select id="PositionId" name="PositionId" class="form-select">
                <option value="">Select Position</option>
                @foreach (var position in ViewBag.Positions)
                {
                    <option value="@position.PositionId">@position.PositionTitle</option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Map Position</button>
    </form>

    <h3>Existing Mappings</h3>
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Organization Name</th>
                <th>Department Name</th>
                <th>Position Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="mappingsTableBody">
            @foreach (var mapping in Model)
            {
                <tr id="row-@mapping.PostMapId">
                    <td id="orgName-@mapping.PostMapId">@mapping.OrganizationName</td>
                    <td id="deptName-@mapping.PostMapId">@mapping.DepartmentName</td>
                    <td id="posTitle-@mapping.PostMapId">@mapping.PositionTitle</td>
                    <td>
                        <button class="btn btn-primary" onclick="editMapping(@mapping.PostMapId)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteMapping(@mapping.PostMapId)">Delete</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#positionMappingForm').submit(function (event) {
                event.preventDefault(); // Prevent the default form submission

                var newPositionMapping = {
                    OrganizationId: $('#OrganizationId').val(),
                    DepartmentId: $('#DepartmentId').val(),
                    PositionId: $('#PositionId').val()
                };

                $.post('@Url.Action("AddPositionMapping", "PositionMapping")', positionMapping, function (response) {
                    if (response.success) {
                        // Append new mapping to the table
                        var newRow = `<tr id="row-${response.postMapId}">
                                                <td id="orgName-${response.postMapId}">${response.organizationName}</td>
                                                <td id="deptName-${response.postMapId}">${response.departmentName}</td>
                                                <td id="posTitle-${response.postMapId}">${response.positionTitle}</td>
                                                <td>
                                                    <button class="btn btn-primary" onclick="editMapping(${response.postMapId})">Edit</button>
                                                    <button class="btn btn-danger" onclick="deleteMapping(${response.postMapId})">Delete</button>
                                                </td>
                                            </tr>`;
                        $('#mappingsTableBody').append(newRow); // Add the new row to the table
                        $('#positionMappingForm')[0].reset(); // Clear the form
                    } else {
                        alert(response.message); // Display error message
                    }
                });
            });
        });

        // function editDepartment(departmentId) {
        //     document.getElementById('name-' + departmentId).style.display = 'none';
        //     document.getElementById('edit-name-' + departmentId).style.display = 'block';
        //     document.querySelector('#row-' + departmentId + ' .update-btn').style.display = 'block';
        //     document.querySelector('#row-' + departmentId + ' .btn-primary').style.display = 'none';
        // }

        // function updateDepartment(departmentId) {
        //     var updatedName = document.getElementById('edit-name-' + departmentId).value;

        //     var updatedData = {
        //         DepartmentId: departmentId,
        //         DepartmentName: updatedName
        //     };

        //     $.post('@Url.Action("UpdateDepartment", "Home")', updatedData, function (response) {
        //         if (response.success) {
        //             document.getElementById('name-' + departmentId).innerText = updatedName;
        //             document.getElementById('name-' + departmentId).style.display = 'block';
        //             document.getElementById('edit-name-' + departmentId).style.display = 'none';
        //             document.querySelector('#row-' + departmentId + ' .update-btn').style.display = 'none';
        //             document.querySelector('#row-' + departmentId + ' .btn-primary').style.display = 'block';
        //         }
        //     });
        // }

        // function deleteDepartment(departmentId) {
        //     if (confirm('Are you sure you want to delete this department?')) {
        //         $.post('@Url.Action("DeleteDepartment", "Home")', { DepartmentId: departmentId }, function (response) {
        //             if (response.success) {
        //                 $('#row-' + departmentId).remove();
        //             }
        //         });
        //     }
        // }
    </script>
}
